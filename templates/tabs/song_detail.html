{% extends 'base.html' %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/style.css' %}" />

<div class="container mx-auto px-5 py-10">
  <div class="max-w-8xl mx-auto pt-4">
    <div class="bg-dark-card border border-dark-border rounded-xl p-8 mb-8">
      <div class="grid grid-cols-1 md:grid-cols-[300px,1fr] gap-8">
        <!-- IMAGE + OVERLAY -->
        <div class="relative aspect-square rounded-lg overflow-hidden group">
          {% if song.album.image %}
          <img
            src="{{ song.artist.artist_img }}"
            alt="{{ song.title }}"
            class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
          />
          {% else %}
          <div
            class="flex  justify-center bg-[#1b1b1b] text-3xl font-bold text-white/70 h-full"
          >
            {{ song.artist.name|upper|slice:":8" }}
          </div>
          {% endif %}

          <!-- Overlay -->
          <div
            class="absolute inset-0 bg-black/90 text-white opacity-0 scale-95 group-hover:opacity-100 group-hover:scale-100 transition-all duration-500 flex flex-col  p-5"
          >
            <div class="flex justify-center items-center gap-6 ">
              <div
                class="menu-item cursor-pointer text-sm font-semibold text-gray-300 hover:text-white active"
                data-tab="description"
              >
                Description
              </div>
              <div
                class="menu-item cursor-pointer text-sm font-semibold text-gray-300 hover:text-white"
                data-tab="changelog"
              >
                Changelog
              </div>
            </div>

            <div
              id="contentArea"
              class="text-gray-300 text-sm max-h-32 overflow-y-auto transition-all duration-300 w-full px-2"
            >
              {% if song.description %}
              <p>{{ song.description }}</p>
              {% else %}
              <p>No description available.</p>
              {% endif %}
            </div>
          </div>
        </div>

        <!-- SONG INFO -->
        <div>
          <div class="flex justify-between items-start mb-4 relative">
            <div>
              <h1 class="text-4xl font-bold mb-2">
                {{ song.title }}
                {% if song.artist_verified %}
                <span class="text-green-400 text-2xl align-middle">âœ”</span>
                {% endif %}
              </h1>
              <p class="text-xl text-dark-text mb-2">
                by {{ song.artist.name }}
              </p>
              <p class="text-lg text-gray-400">
                from {{ song.album.title }} ({{ song.album.release_year }})
              </p>
            </div>

            {% if song.tab_files %}
            <a
  href="{{ song.tab_files }}"
  target="_blank"
  style="
    display: inline-block;
    background: #1a1a1a;
    color: #fff;
    border: 1px solid #fff;
    border-radius: 9999px;
    padding: 0.4rem 1rem;
    font-size: 0.9rem;
    font-weight: 600;
    text-decoration: none;
    position: absolute;
    top: 50%;
    right: 0;
    transform: translateY(-50%);
    transition: all 0.3s ease;
  "
  onmouseover="this.style.background='#3b0764'; this.style.borderColor='#3b0764';"
  onmouseout="this.style.background='#1a1a1a'; this.style.borderColor='#fff';"
>
  Download Tab
</a>

            {% endif %}
          </div>

          <p class="text-sm text-gray-400 mb-2">
            Added {{ song.date_added|date:"F d, Y" }}
          </p>

          {% if song.tabber.exists %}
          <h3 class="text-lg font-semibold mb-2" style="font-size:1.125rem;font-weight:600;margin-bottom:0.5rem;">Tabber(s):</h3>

<div class="flex flex-wrap gap-2" style="display:flex;flex-wrap:wrap;gap:0.5rem;">
  {% for tabber in song.tabber.all %}
  <div class="tabber-badge" style="display:flex;align-items:center;gap:0.5rem;border:1px solid #444;background:#1a1a1a;padding:0.4rem 0.75rem;border-radius:0.5rem;">
    <div class="tabber-avatar" style="background:#3b0764;color:#fff;width:28px;height:28px;display:flex;align-items:center;justify-content:center;border-radius:50%;font-weight:700;">
      {{ tabber.name|first|upper }}
    </div>
    <span class="text-sm" style="font-size:0.9rem;color:#eee;">{{ tabber.name }}</span>
  </div>
  {% endfor %}
</div>

          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>


<script>
  document.addEventListener("DOMContentLoaded", () => {
    const menuItems = document.querySelectorAll(".menu-item");
    const contentArea = document.getElementById("contentArea");

    const descriptionHTML = `<p>{{ song.description|default:'No description available.' }}</p>`;
    const changelogHTML = `<p>{{ song.changelog|default:'No changelog available.' }}</p>`;

    menuItems.forEach((item) => {
      item.addEventListener("click", () => {
        menuItems.forEach((i) => i.classList.remove("active"));
        item.classList.add("active");
        contentArea.style.opacity = "0";
        setTimeout(() => {
          contentArea.innerHTML =
            item.dataset.tab === "description"
              ? descriptionHTML
              : changelogHTML;
          contentArea.style.opacity = "1";
        }, 200);
      });
    });
  });
</script>

{% endblock %}
